# NOTE:
#   This is the base configuration file defining common
#   known variables and their respective default values.
#
#   Collections may override this as needed.
#
#   Do not edit this file directly.
#   Instead, create a file containing
#   your customizations in <project root>/profiles/.
#   
#   Typically, at least DBUILD_TARGET_COLLECTIONS must be set there.
#

# Build environment
# -----------------

# Proxy URL to be used during mmdebstrap
#DBUILD_APT_PROXY*='http://localhost:3142'
DBUILD_APT_PROXY*=''

# Base path for temporary files and directories
#
#  If empty, the staging root directory will be used.
#
DBUILD_TMPDIR_ROOT*=''

DBUILD_TARGET_ARCH*='amd64'
DBUILD_TARGET_CODENAME*='bookworm'
DBUILD_TARGET_COMPONENTS*='main'

DBUILD_TARGET_VARIANT*='apt'

# Profile name
#   Should be left empty, gets automatically set by mkimage.
#
DBUILD_PROFILE_NAME*=''


# List of collections to use
#
#   Each collection provides configuration for the target.
#   Several collections may be listed.
#   
#   Some collections conflict, e.g. systemd <> sysvinit,
#   but usually it is safe to mix collections.
#
#   Must not be empty - should be set in the profile config.
#
DBUILD_TARGET_COLLECTIONS*=''

# Init system used by the target,
# typically either systemd or sysvinit
#
#   This should not be set manually.
#   Include the corresponding collection instead,
#   which also provides necessary shell helpers,
#   e.g. for enable services. 
#
DBUILD_TARGET_INIT_SYSTEM*='unknown'

# Output image format
#
# Choose from: tar, null
#
# When using the 'null' output format, one (or more)
# collections are responsible for creating output image(s).
#
# Defaults to 'tar'.
#
DBUILD_TARGET_IMAGE_FORMAT*='tar'


# User Accounts
# -------------

# By default, two unprivileged users will be created:
# - a login user that may elevate to root via su(1)
# - an additional user that may not log in and to whom only root can switch
#   via su -l -s /bin/ksh <name>.
#   This user account is meant for unprivileged admin purposes.
#
# The users will be named cosmo & wanda unless overridden in config.local.
#

# Password for root
#   This may be a plain password or a hash (starting with '$').
#   Password beginning with a literal '$' must be provided in hashed form.
OCONF_INSTALL_ROOT_PASSWORD*=''

# login user (REQUIRED)
#
#  Specify the user name here, the uid will be 1000.
#
#  No passphrase will be set ('*' as password hash).
#
#  SSH access can be disabled by setting OFEAT_LOGIN_USER_SSH=0
#  and fine-tuned via OFEAT_LOGIN_USER_SSH_<access_group>=0|1.
#
OFEAT_LOGIN_USER*=1
OFEAT_LOGIN_USER_RAMDISK*=0
OCONF_LOGIN_USER_RAMDISK_SIZE*=1
OFEAT_LOGIN_USER_SSH*=1
OFEAT_LOGIN_USER_SSH_SHELL*=1
OFEAT_LOGIN_USER_SSH_FORWARDING*=0
OCONF_LOGIN_USER*='cosmo'
OCONF_LOGIN_UID*='1000'

# Password for the login user
#   This may be a plain password or a hash (starting with '$').
#   Password beginning with a literal '$' must be provided in hashed form.
OCONF_LOGIN_USER_PASSWORD*=''

# SSH public key for the login user
#
#  If unset, the login user may still login via SSH using password auth.
#
#OCONF_LOGIN_SSH_KEY='ssh-rsa ...'
OCONF_LOGIN_SSH_KEY*=

# unprivileged user
#
#   Set the user name and its uid here.
#   The passphrase will be set to "login disabled" (thirteen asterisk chars),
#   it can not be controlled here.
#
#   Can be disabled by setting the user name to the empty string.
#
OFEAT_UNPRIV_USER*=1
OCONF_UNPRIV_USER*='wanda'
OCONF_UNPRIV_UID*='1001'

# control user
#  You may optionally configure a user for automated control purposes
#  (configuration management / orchestration, e.g. Ansible).
#
#  The user will be granted sudo privileges in NOPASS mode.
#
#  The home directory will be empty.
#  By default, a ramdisk of roughly 120m in size will be created.
#
#  This user will be able to log in via SSH with public keys only.
#  Public keys are managed in /etc/ssh/authorized_keys/<user>.
#  You may also configure a single key here.
#
#  Notes:
#    - sudo(8) will be configured for that user only,
#      overriding any other configuration
#    - OFEAT_CTRL_USER_SSH defaults to 1
#      (capped by OFEAT_CTRL_USER)
#
OFEAT_CTRL_USER*=0
OFEAT_CTRL_USER_RAMDISK*=1
OCONF_CTRL_USER_RAMDISK_SIZE*=50
OCONF_CTRL_USER*='ctrl'
OCONF_CTRL_UID*='999'
OFEAT_CTRL_USER_SSH*=1
OFEAT_CTRL_USER_SSH_SHELL*=1
OFEAT_CTRL_USER_SSH_FORWARDING*=0
OCONF_CTRL_SSH_KEY*=''
#OCONF_CTRL_SSH_FROM*='' ## NOT_IMPLEMENTED

# SSH Server
# ----------

# Whether to generate /etc/ssh/sshd_config from template
#
#   Basic and very restrictive configuration.
#
#   Access is granted based on group membership ("ssh-<access>"):
#
#     - Only members in the 'login' this group may log in,
#       regardless of any other ssh-* membership
#
#     - The 'shell' group grants access to a PTY
#
#     - The 'forwarding' group enables TCP forwarding
#
#   The names and ids of these groups may be changed below.
#
#   For the builtin user accounts,
#   the default permissions are as follows:
#
#     - login  (OCONF_LOGIN_USER)  : login, shell
#     - ctrl   (OCONF_CTRL_USER)   : login, shell
#     - unpriv (OCONF_UNPRIV_USER) : no access [not configurable]
#     - root   (<system user>)     : no access [not configurable]
#
OFEAT_SSHD_CONFIG*=1

# SSH access group names and their ids, mandatory
#
#  An error is raised if a group is missing but its gid is already taken.
#  If a group with that name does already exist, its gid will remain unchanged.
#
OCONF_SSHD_GROUP_LOGIN*="ssh-login"
OCONF_SSHD_GID_LOGIN*="900"

OCONF_SSHD_GROUP_SHELL*="ssh-shell"
OCONF_SSHD_GID_SHELL*="901"

OCONF_SSHD_GROUP_FORWARDING*="ssh-forwarding"
OCONF_SSHD_GID_FORWARDING*="902"

# Packages Installation
# ---------------------

# feature: Whether to install packages listed in OCONF_PKG_INSTALL on first boot
OFEAT_PKG_INSTALL*=1

# List of packages to be installed
OCONF_PKG_INSTALL*=""

# feature: install 
OFEAT_ANSIBLE_CTRL*=0

# System Configuration
# --------------------

# Hostname
OCONF_HOSTNAME*='staging'

# Keyboard Layout
#
#   Examples: us
#
#  TODO/NOTE: NOT IMPLEMENTED
OCONF_KBD_LAYOUT*=''

# Timezone
#
#   This must be the name of a timezone file
#   as present in /usr/share/zoneinfo/,  e.g. 'UTC' or 'Europe/Berlin'.
#   FIXME: must be <region>/<name>, not UTC
#
OCONF_TIMEZONE*='Europe/Berlin'

# Whether to use the merged-usr layout
#
#   The configuration is split into two separate options:
#
#     * Whether to instruct mmdebstrap to use a specific (no-)merged-usr hook
#       -> set OFEAT_MMDEBSTRAP_MERGED_USR=1
#          and OCONF_MMDEBSTRAP_MERGED_USR "no-merged-usr" or "merged-usr"
#
#     * Whether to assume a merged-usr layout in build-image and hook scripts
#       -> set OFEAT_MERGED_USR to 0 (no-merged-usr) 1 (merged-usr)
#
OFEAT_MMDEBSTRAP_MERGED_USR*=1
OCONF_MMDEBSTRAP_MERGED_USR*='merged-usr'
OFEAT_MERGED_USR*=1

# Downsize the target rootfs by excluding non-essential files
#
OFEAT_ROOTFS_MINIMAL*=0
OFEAT_ROOTFS_MINIMAL_USR_SHARE*=0

# Whether to install man pages
#
#   This is usually a good idea..
#
OFEAT_MAN_PAGES*=0

# Whether to install the cron daemon
#
#   Not strictly necessary (especially when using systemd timers), but it's
#   unknown to me how much Debian relies on it on for normal operation.
#
OFEAT_CRON*=1

# Whether to install rsyslog
#
#   By default, no syslog daemon is installed.
#   For systemd hosts, only a volatile journal will be configured.
#
OFEAT_RSYSLOG*=0

# Whether to install haveged for extra entropy
#
#   This is mostly useful for virtual machines
#   when gpg, ... hangs due to low entropy.
#
OFEAT_HAVEGED*=0

# Whether to create an empty /etc/machine-id file
#
#   If unset, /etc/machine-id will be deleted.
#
OFEAT_ETC_MACHINE_ID*=0

# Whether to enable various tmpfs mounts
#
#   Disabled in the base configuration,
#   should only be enabled in more specific collections.
#
#   If disabled (unset or set to 0), this will disable
#   all tmpfs mounts for the following mountpoints:
#
#     - /dev/shm    [OS will still mount this as tmpfs]
#     - /tmp
#     - /var/tmp
#     - /run        [OS will still mount this as tmpfs]
#
OFEAT_TMPFS_MOUNTS*=0
OCONF_TMPFS_DEV_SHM_SIZE*='10%'
OCONF_TMPFS_TMP_SIZE*='20%'
OCONF_TMPFS_VAR_TMP_SIZE*='20%'
OCONF_TMPFS_RUN_SIZE*='10%'

# Whether to use a tmpfs mount for /var/cache/apt
#
#   Disabled in the base configuration,
#   should only be enabled in more specific collections.
OFEAT_TMPFS_APT_CACHE*=0
OCONF_TMPFS_APT_CACHE_SIZE*='50%'

# Whether to configure custom kernel boot parameters
#
#   This is a value-merged variable,
#   (re)setting it will extend its original value.
#
OFEAT_BOOT_CMDLINE*=0
OCONF_BOOT_CMDLINE*=''

# Whether to install a kernel image
#
#  If set to true (1), then a kernel package name
#  must also been given via OCONF_KERNEL_IMAGE.
#
#  NOTE: This is usually set by a collection
#        that requires a kernel image depending on the target.
#        (Containers don't their own kernel, VMs do.)
#
OFEAT_KERNEL_IMAGE*=0
OCONF_KERNEL_IMAGE*=

# Whether to reduce the size of installed kernel images
# at the expense of functionality
#
#   If set to true (1), some kernel modules will be excluded
#   when installing, which helps to reduce the rootfs size.
#
#   While the base collection introduces this configuration option,
#   it is up to more specific collections to actually exclude kernel modules.
#   For example, this could remove bluetooth support from pure VM images.
#
#   NOTE: configured independently of OFEAT_ROOTFS_MINIMAL
#
OFEAT_ROOTFS_MINIMAL_KERNEL*=0

# Whether to include support for signed UEFI booting (bootloader/kernel)
#
#  NOTE: This feature is not implemented in the base collection.
#        Include the bootloader/kernel collection to enable it, e.g. vm/uefi.
OFEAT_UEFI_SECURE_BOOT*=0


# Network Configuration
# ---------------------

# Predictable Network Interface Names
#
#   Set to 1 to enable, 0 to disable renaming of network interfaces.
#
#   See also:
#     https://wiki.debian.org/NetworkInterfaceNames
#     https://www.freedesktop.org/wiki/Software/systemd/PredictableNetworkInterfaceNames/
#
OFEAT_IFNAMES*=1

# Whether to generate /etc/resolv.conf
#
#   Note that disabling this will remove /etc/resolv.conf
#
OFEAT_RESOLV_CONF*=1

# List of nameservers for /etc/resolv.conf
# (if OFEAT_RESOLV_CONF is set to 1)
#
#   Must not be empty when OFEAT_RESOLV_CONF is enabled.
#   The setting below uses the servers from OpenDNS.
#
OCONF_RESOLV_CONF_NS*='208.67.222.222 208.67.220.220'

# List of search domains for /etc/resolv.conf
# (if OFEAT_RESOLV_CONF is set to 1)
OCONF_RESOLV_CONF_SEARCH*=''

# Network Interface Configuration
#
#  Allows to automatically configure one(!) ethernet interface.
#  (but see multi-interface exception for systemd-networkd below.)
#
#  NOTE: This feature is not implemented in the base collection.
#        Include the init-specific collection to enable it, e.g. systemd.
#
#  NOTE: This feature may implicitly install and enable a network manager
#        such as ifupdown2 or systemd-networkd.
#
#  NOTE: auto configuration may override other DNS or NTP configuration
#        (OFEAT_RESOLV_CONF, ...)
#
#  First, you need to enable network configuration and select
#  an appropriate config provider by pulling in one of the networ
#  config providers. See collections/netconfig/ for a list of th
#  default config providers. Note, however, that this may
#  further be restricted by your choice of init system.
#
#    DBUILD_TARGET_COLLECTIONS="... netconfig/systemd-networkd ..."
#
#  Internally, this will set two variables:
#
#    OFEAT_NETCONFIG=1
#    OCONF_NETCONFIG_PROVIDER='<PROVIDER>'
#
#  Then, specify which interface should be configured.
#  This can be done either by MAC address or interface name.
#  MAC address takes precedence if both are set to a non-empty value.
#
#    OCONF_NETCONFIG_IFACE_BY_MAC=
#    OCONF_NETCONFIG_IFACE_BY_NAME='eth0'
#
#  The systemd-networkd config provider also allows to set
#  OCONF_NETCONFIG_IFACE_BY_NAME to an empty value (or asterisk),
#  in which case all ethernet interfaces will be configured.
#  Make sure not to mix this with interface renaming or static IP
#  configuration unless you really expect to have only single eth interface.
#
#  You may also set a custom name for the interface,
#  if the config provider supports it.
#
#    OCONF_NETCONFIG_IFACE_NAME='lan'
#
#  Then, select how the IP addresses should be configured.
#  Depending on the config method,  additional options may be set,
#  e.g. for static addressing. Note that mixing DHCP with static
#  addressing may or may not be a good idea.
#
#    OFEAT_NETCONFIG_IP4=1                  # configure IPv4 address
#    OFEAT_NETCONFIG_IP4_DHCP=1             # use DHCP
#    OFEAT_NETCONFIG_IP4_STATIC=1           # and/or use static IPv4
#    OCONF_NETCONFIG_IP4_STATIC='198.51.100.2/24'
#    OCONF_NETCONFIG_IP4_STATIC_GW='198.51.100.1'
#
#    OFEAT_NETCONFIG_IP6=1                  # configure IPv6 address
#    OFEAT_NETCONFIG_IP6_SLAAC=1            # use SLAAC
#    OFEAT_NETCONFIG_IP6_DHCP6=1            # and/or use DHCPv6
#    OFEAT_NETCONFIG_IP6_STATIC=1           # and/or use static IPv6
#    OCONF_NETCONFIG_IP6_STATIC='2001:db8::2/64'
#    OCONF_NETCONFIG_IP6_STATIC_GW='fe80::1'
#
OFEAT_NETCONFIG*=0
OCONF_NETCONFIG_PROVIDER*=''
OCONF_NETCONFIG_IFACE_BY_MAC*=''
OCONF_NETCONFIG_IFACE_BY_NAME*='eth0'
OCONF_NETCONFIG_IFACE_NAME*=''

OFEAT_NETCONFIG_IP4*=1
OFEAT_NETCONFIG_IP4_DHCP*=1
OFEAT_NETCONFIG_IP4_STATIC*=0
OCONF_NETCONFIG_IP4_STATIC*=''
OCONF_NETCONFIG_IP4_STATIC_GW*=''

OFEAT_NETCONFIG_IP6*=1
OFEAT_NETCONFIG_IP6_DHCP*=0
OFEAT_NETCONFIG_IP6_SLAAC*=1
OFEAT_NETCONFIG_IP6_STATIC*=0
OCONF_NETCONFIG_IP6_STATIC*=''
OCONF_NETCONFIG_IP6_STATIC_GW*=''
